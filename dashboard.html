<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | GH Consulting</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #000; color: #fff; min-height: 100vh; }
        .app { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 220px; background: #000; border-right: 1px solid #1a1a1a; padding: 24px 16px; position: fixed; height: 100vh; display: flex; flex-direction: column; }
        .logo { font-size: 11px; font-weight: 600; letter-spacing: 2px; color: #fff; margin-bottom: 8px; }
        .logo-sub { font-size: 10px; color: #444; margin-bottom: 32px; }
        .nav-label { font-size: 9px; font-weight: 600; color: #333; text-transform: uppercase; letter-spacing: 1px; margin: 24px 0 12px; }
        .nav-item { display: block; padding: 10px 12px; color: #666; font-size: 13px; cursor: pointer; transition: all 0.15s; border-radius: 6px; margin-bottom: 2px; }
        .nav-item:hover { color: #fff; background: #111; }
        .nav-item.active { color: #fff; background: #111; }
        .nav-badge { background: #fff; color: #000; font-size: 9px; padding: 2px 6px; border-radius: 10px; margin-left: 8px; }
        .sidebar-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid #1a1a1a; }
        .user-avatar { width: 36px; height: 36px; background: #111; border: 1px solid #333; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 500; }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-name { font-size: 13px; font-weight: 500; }
        .user-email { font-size: 10px; color: #666; margin-top: 2px; }
        
        /* Main */
        .main { flex: 1; margin-left: 220px; padding: 32px 40px; }
        
        /* Header */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; }
        .page-header h1 { font-size: 22px; font-weight: 400; }
        .page-header p { color: #666; font-size: 13px; margin-top: 4px; }
        .header-actions { display: flex; gap: 12px; }
        
        /* Buttons */
        .btn { padding: 10px 18px; font-size: 12px; font-weight: 500; cursor: pointer; border: 1px solid #333; background: transparent; color: #fff; font-family: inherit; border-radius: 6px; transition: all 0.2s; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }
        .btn:hover { border-color: #555; background: #111; }
        .btn-primary { background: #fff; color: #000; border-color: #fff; }
        .btn-primary:hover { background: #eee; border-color: #eee; }
        .btn-sm { padding: 8px 14px; font-size: 11px; }
        
        /* Alert */
        .alert { padding: 16px 20px; border: 1px solid #333; background: #0a0a0a; margin-bottom: 24px; display: flex; align-items: center; justify-content: space-between; font-size: 13px; border-radius: 8px; }
        .alert strong { color: #fff; }
        
        /* Stats */
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
        .stat { background: #0a0a0a; border: 1px solid #1a1a1a; padding: 20px; border-radius: 8px; }
        .stat-label { font-size: 10px; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .stat-value { font-size: 28px; font-weight: 300; }
        .stat-sub { font-size: 11px; color: #666; margin-top: 6px; }
        .stat-change { font-size: 11px; margin-top: 6px; }
        .stat-change.up { color: #888; }
        
        /* Grid & Cards */
        .grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 24px; }
        .card { border: 1px solid #1a1a1a; padding: 20px; margin-bottom: 20px; background: #0a0a0a; border-radius: 8px; }
        .card-title { font-size: 11px; color: #666; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid #1a1a1a; display: flex; justify-content: space-between; align-items: center; }
        .card-title span { font-size: 10px; text-transform: none; letter-spacing: 0; }
        
        /* Progress */
        .progress-row { margin-bottom: 20px; }
        .progress-header { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 8px; }
        .progress-header span:last-child { color: #666; }
        .progress-bar { height: 6px; background: #1a1a1a; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: #fff; border-radius: 3px; transition: width 0.5s ease; }
        
        /* Links */
        .link-item { display: flex; align-items: center; gap: 12px; padding: 14px; border: 1px solid #1a1a1a; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; text-decoration: none; color: #fff; border-radius: 6px; }
        .link-item:hover { border-color: #333; background: #111; }
        .link-icon { width: 40px; height: 40px; background: #111; display: flex; align-items: center; justify-content: center; font-size: 18px; border-radius: 8px; }
        .link-title { font-size: 13px; font-weight: 500; }
        .link-desc { font-size: 11px; color: #666; margin-top: 2px; }
        
        /* Calls */
        .call-item { padding: 20px; border: 1px solid #1a1a1a; margin-bottom: 12px; background: #050505; border-radius: 8px; }
        .call-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .call-date { font-size: 14px; font-weight: 500; }
        .call-duration { font-size: 11px; color: #666; margin-top: 4px; }
        .call-meta { text-align: right; }
        .call-section { margin-bottom: 16px; }
        .call-section:last-child { margin-bottom: 0; }
        .call-section-title { font-size: 10px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .call-transcript { font-size: 13px; color: #888; line-height: 1.6; max-height: 100px; overflow-y: auto; padding: 12px; background: #0a0a0a; border-radius: 4px; }
        .call-problems { list-style: none; }
        .call-problems li { font-size: 13px; color: #888; padding: 8px 0; border-bottom: 1px solid #111; }
        .call-problems li:last-child { border-bottom: none; }
        .call-suggestion { font-size: 13px; color: #fff; padding: 12px; background: #111; border-left: 2px solid #fff; border-radius: 0 4px 4px 0; }
        .call-actions { display: flex; gap: 8px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #1a1a1a; }
        
        /* Problems */
        .problem { padding: 16px; border: 1px solid #1a1a1a; margin-bottom: 12px; background: #050505; border-radius: 6px; }
        .problem-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .problem-title { font-size: 13px; font-weight: 500; }
        .problem-date { font-size: 10px; color: #666; }
        .problem-text { font-size: 12px; color: #888; line-height: 1.5; }
        .problem-status { font-size: 10px; padding: 4px 10px; border-radius: 4px; margin-top: 10px; display: inline-block; cursor: pointer; }
        .problem-status.open { background: #1a1a1a; color: #888; }
        .problem-status.resolved { background: #111; color: #fff; }
        
        /* Weekly rows */
        .week-row { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #111; font-size: 13px; }
        .week-row:last-child { border-bottom: none; }
        .week-date { width: 80px; color: #666; }
        .week-metric { flex: 1; text-align: center; }
        
        /* Forms */
        .form-group { margin-bottom: 20px; }
        .form-label { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; display: block; }
        .form-input { width: 100%; padding: 12px; background: #111; border: 1px solid #222; color: #fff; font-size: 14px; font-family: inherit; border-radius: 6px; transition: border-color 0.2s; }
        .form-input:focus { outline: none; border-color: #555; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        textarea.form-input { min-height: 80px; resize: vertical; }
        
        /* Pages */
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 100; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: #0a0a0a; border: 1px solid #1a1a1a; padding: 28px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; border-radius: 12px; }
        .modal-title { font-size: 18px; font-weight: 400; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid #1a1a1a; }
        
        /* Empty */
        .empty { text-align: center; padding: 40px; color: #666; }
        
        /* Config */
        .config-item { display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #1a1a1a; margin-bottom: 8px; border-radius: 6px; }
        .config-item input { flex: 1; }
        .config-label { width: 90px; font-size: 12px; color: #888; }
        
        /* Footer */
        .footer { text-align: center; padding: 20px; font-size: 10px; color: #333; margin-top: 40px; }
        
        /* Responsive */
        @media (max-width: 1000px) { .stats { grid-template-columns: repeat(2, 1fr); } .grid { grid-template-columns: 1fr; } }
        @media (max-width: 700px) { .sidebar { display: none; } .main { margin-left: 0; padding: 20px; } .stats { grid-template-columns: 1fr; } .header-actions { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="logo">GH CONSULTING</div>
            <div class="logo-sub">Dashboard del Cliente</div>
            
            <div class="nav-label">Principal</div>
            <div class="nav-item active" onclick="showPage('dashboard')">Dashboard</div>
            <div class="nav-item" onclick="showPage('metricas')">Historial</div>
            
            <div class="nav-label">Semanal</div>
            <div class="nav-item" onclick="showPage('reporte')">Reporte<span class="nav-badge" id="reportBadge" style="display:none;">!</span></div>
            <div class="nav-item" onclick="showPage('problemas')">Problemas</div>
            
            <div class="nav-label">Llamadas</div>
            <div class="nav-item" onclick="showPage('llamadas')">Registro</div>
            
            <div class="nav-label">Recursos</div>
            <div class="nav-item" onclick="showPage('links')">Mis Links</div>
            <div class="nav-item" onclick="showPage('config')">Configurar</div>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar" id="avatar">--</div>
                    <div>
                        <div class="user-name" id="userName">...</div>
                        <div class="user-email" id="userEmail">...</div>
                    </div>
                </div>
            </div>
        </aside>
        
        <main class="main" id="main"></main>
    </div>
    
    <!-- Modal Reporte -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-title">Reporte Semanal</div>
            <form id="weeklyForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Ingresos esta semana (EUR)</label>
                        <input type="number" class="form-input" id="rpt_ingresos" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nuevos clientes</label>
                        <input type="number" class="form-input" id="rpt_clientes" placeholder="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Calls realizadas</label>
                        <input type="number" class="form-input" id="rpt_calls" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Leads/DMs</label>
                        <input type="number" class="form-input" id="rpt_leads" placeholder="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Contenido publicado</label>
                        <input type="number" class="form-input" id="rpt_contenido" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nuevos seguidores</label>
                        <input type="number" class="form-input" id="rpt_seguidores" placeholder="0">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notas / Observaciones</label>
                    <textarea class="form-input" id="rpt_notas" placeholder="Que paso esta semana? Que aprendiste?"></textarea>
                </div>
                <div style="display:flex;gap:12px;margin-top:24px;">
                    <button type="button" class="btn" onclick="closeModal('reportModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">Enviar Reporte</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal Problema -->
    <div class="modal" id="problemModal">
        <div class="modal-content">
            <div class="modal-title">Reportar Problema</div>
            <form id="problemForm">
                <div class="form-group">
                    <label class="form-label">Titulo del problema</label>
                    <input type="text" class="form-input" id="prob_titulo" placeholder="Ej: No consigo cerrar calls">
                </div>
                <div class="form-group">
                    <label class="form-label">Descripcion</label>
                    <textarea class="form-input" id="prob_desc" placeholder="Explica el problema en detalle..."></textarea>
                </div>
                <div style="display:flex;gap:12px;margin-top:24px;">
                    <button type="button" class="btn" onclick="closeModal('problemModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">Guardar</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal Llamada -->
    <div class="modal" id="callModal">
        <div class="modal-content">
            <div class="modal-title">Registrar Llamada</div>
            <form id="callForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Fecha</label>
                        <input type="date" class="form-input" id="call_fecha">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duracion (min)</label>
                        <input type="number" class="form-input" id="call_duracion" placeholder="30">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Resumen / Transcripcion</label>
                    <textarea class="form-input" id="call_transcript" style="min-height:120px;" placeholder="Puntos clave de la llamada..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Problemas tratados (uno por linea)</label>
                    <textarea class="form-input" id="call_problemas" placeholder="Problema 1&#10;Problema 2"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Sugerencias / Proximos pasos</label>
                    <textarea class="form-input" id="call_sugerencias" placeholder="Acciones a tomar..."></textarea>
                </div>
                <div style="display:flex;gap:12px;margin-top:24px;">
                    <button type="button" class="btn" onclick="closeModal('callModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary" style="flex:1;">Guardar Llamada</button>
                </div>
            </form>
        </div>
    </div>

<script>
var data = null;
try { var s = localStorage.getItem('gh_client_data'); if (s) data = JSON.parse(s); } catch(e) {}

var weeklyReports = [];
try { var w = localStorage.getItem('gh_weekly_reports'); if (w) weeklyReports = JSON.parse(w); } catch(e) {}

var problems = [];
try { var p = localStorage.getItem('gh_problems'); if (p) problems = JSON.parse(p); } catch(e) {}

var clientLinks = {drive: '', miro: '', otros: '', calendly: ''};
try { var l = localStorage.getItem('gh_client_links'); if (l) clientLinks = {...clientLinks, ...JSON.parse(l)}; } catch(e) {}

var calls = [];
try { var c = localStorage.getItem('gh_calls'); if (c) calls = JSON.parse(c); } catch(e) {}

var main = document.getElementById('main');

// Calendly URL - configurable
var CALENDLY_URL = clientLinks.calendly || 'https://calendly.com/guillermohf';

if (!data || !data.nombre) {
    main.innerHTML = '<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:80vh;text-align:center;"><h2 style="font-size:20px;font-weight:400;margin-bottom:8px;">Bienvenido a GH Consulting</h2><p style="color:#666;font-size:14px;margin-bottom:32px;">Completa el onboarding para acceder a tu dashboard personalizado</p><a href="index.html" class="btn btn-primary" style="text-decoration:none;">Comenzar Onboarding</a></div>';
} else {
    var hour = new Date().getHours();
    var greeting = hour < 12 ? 'Buenos dias' : hour < 19 ? 'Buenas tardes' : 'Buenas noches';
    var firstName = data.nombre.split(' ')[0];
    var initials = data.nombre.split(' ').map(function(n){return n[0]}).join('').toUpperCase().slice(0,2);
    
    var ingresos = parseInt(data.ingresos) || 0;
    var objetivo = parseInt(data.objetivo) || 0;
    
    var totalIngresos = ingresos;
    var totalClientes = parseInt(data.clientes) || 0;
    var totalCalls = 0;
    var totalLeads = 0;
    var totalContenido = 0;
    weeklyReports.forEach(function(r) {
        totalIngresos += parseInt(r.ingresos) || 0;
        totalClientes += parseInt(r.clientes) || 0;
        totalCalls += parseInt(r.calls) || 0;
        totalLeads += parseInt(r.leads) || 0;
        totalContenido += parseInt(r.contenido) || 0;
    });
    
    var progreso = objetivo > 0 ? Math.round((totalIngresos / objetivo) * 100) : 0;
    var openProblems = problems.filter(function(p){ return p.status === 'open'; }).length;
    
    // Check if report needed
    var lastReport = weeklyReports.length > 0 ? new Date(weeklyReports[weeklyReports.length-1].date) : null;
    var daysSinceReport = lastReport ? Math.floor((new Date() - lastReport) / (1000*60*60*24)) : 999;
    var needsReport = daysSinceReport >= 7;
    
    document.getElementById('avatar').textContent = initials;
    document.getElementById('userName').textContent = data.nombre;
    document.getElementById('userEmail').textContent = data.email;
    if (needsReport) document.getElementById('reportBadge').style.display = 'inline';
    
    // History HTML
    var historyHtml = '';
    if (weeklyReports.length === 0) {
        historyHtml = '<div class="empty">Aun no has enviado reportes semanales.<br><br><button class="btn btn-primary btn-sm" onclick="openModal(\'reportModal\')">Enviar primer reporte</button></div>';
    } else {
        historyHtml = '<div class="week-row" style="font-weight:500;color:#444;font-size:10px;text-transform:uppercase;letter-spacing:0.5px;"><div class="week-date">Fecha</div><div class="week-metric">EUR</div><div class="week-metric">Clientes</div><div class="week-metric">Calls</div><div class="week-metric">Leads</div><div class="week-metric">Content</div></div>';
        weeklyReports.slice(-10).reverse().forEach(function(r) {
            var d = new Date(r.date);
            historyHtml += '<div class="week-row"><div class="week-date">'+d.getDate()+'/'+(d.getMonth()+1)+'</div><div class="week-metric" style="color:#fff;">'+formatMoney(r.ingresos||0)+'</div><div class="week-metric">'+(r.clientes||0)+'</div><div class="week-metric">'+(r.calls||0)+'</div><div class="week-metric">'+(r.leads||0)+'</div><div class="week-metric">'+(r.contenido||0)+'</div></div>';
        });
    }
    
    // Problems HTML
    var problemsHtml = '';
    if (problems.length === 0) {
        problemsHtml = '<div class="empty">No hay problemas registrados<br><br><button class="btn btn-sm" onclick="openModal(\'problemModal\')">Reportar un problema</button></div>';
    } else {
        problems.slice().reverse().forEach(function(p, i) {
            var d = new Date(p.date);
            var statusClass = p.status === 'open' ? 'open' : 'resolved';
            var statusText = p.status === 'open' ? 'Abierto' : 'Resuelto';
            problemsHtml += '<div class="problem"><div class="problem-header"><div class="problem-title">'+p.titulo+'</div><div class="problem-date">'+d.getDate()+'/'+(d.getMonth()+1)+'</div></div><div class="problem-text">'+p.desc+'</div><span class="problem-status '+statusClass+'" onclick="toggleProblem('+(problems.length-1-i)+')">'+statusText+'</span></div>';
        });
    }
    
    // Calls HTML
    var callsHtml = '';
    if (calls.length === 0) {
        callsHtml = '<div class="empty">No hay llamadas registradas<br><br><button class="btn btn-sm" onclick="openModal(\'callModal\')">Registrar primera llamada</button></div>';
    } else {
        calls.slice().reverse().forEach(function(c, i) {
            var d = new Date(c.fecha);
            var problemsList = (c.problemas || '').split('\n').filter(function(p){return p.trim();});
            callsHtml += '<div class="call-item">';
            callsHtml += '<div class="call-header"><div><div class="call-date">'+d.getDate()+'/'+(d.getMonth()+1)+'/'+d.getFullYear()+'</div><div class="call-duration">'+(c.duracion||30)+' min</div></div><div class="call-meta"><button class="btn btn-sm" onclick="deleteCall('+(calls.length-1-i)+')">Eliminar</button></div></div>';
            if (c.transcript) {
                callsHtml += '<div class="call-section"><div class="call-section-title">Resumen</div><div class="call-transcript">'+c.transcript.replace(/\n/g,'<br>')+'</div></div>';
            }
            if (problemsList.length > 0) {
                callsHtml += '<div class="call-section"><div class="call-section-title">Problemas tratados</div><ul class="call-problems">';
                problemsList.forEach(function(p){ callsHtml += '<li>'+p+'</li>'; });
                callsHtml += '</ul></div>';
            }
            if (c.sugerencias) {
                callsHtml += '<div class="call-section"><div class="call-section-title">Sugerencias</div><div class="call-suggestion">'+c.sugerencias.replace(/\n/g,'<br>')+'</div></div>';
            }
            callsHtml += '</div>';
        });
    }
    
    function linkHtml(title, desc, url) {
        if (url) {
            return '<a href="'+url+'" target="_blank" class="link-item"><div class="link-icon">-</div><div><div class="link-title">'+title+'</div><div class="link-desc">'+desc+'</div></div></a>';
        }
        return '<div class="link-item" style="opacity:0.4;cursor:default;"><div class="link-icon">-</div><div><div class="link-title">'+title+'</div><div class="link-desc" style="color:#555;">No configurado</div></div></div>';
    }
    
    main.innerHTML = `
        <!-- DASHBOARD -->
        <div class="page active" id="page-dashboard">
            <div class="page-header">
                <div><h1>${greeting}, ${firstName}</h1><p>Semana ${weeklyReports.length + 1} de tu programa</p></div>
                <div class="header-actions">
                    <a href="${CALENDLY_URL}" target="_blank" class="btn">Reservar llamada 1-1</a>
                    <button class="btn btn-primary" onclick="openModal('reportModal')">Reporte Semanal</button>
                </div>
            </div>
            
            ${needsReport ? '<div class="alert"><div><strong>Toca reporte semanal</strong> — Actualiza tus metricas para ver tu progreso real</div><button class="btn btn-primary btn-sm" onclick="openModal(\'reportModal\')">Enviar ahora</button></div>' : ''}
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Ingresos Totales</div>
                    <div class="stat-value">${formatMoney(totalIngresos)}</div>
                    <div class="stat-sub">de ${formatMoney(objetivo)} objetivo</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Clientes</div>
                    <div class="stat-value">${totalClientes}</div>
                    ${weeklyReports.length > 0 ? '<div class="stat-change up">+' + (totalClientes - parseInt(data.clientes||0)) + ' del programa</div>' : '<div class="stat-sub">activos</div>'}
                </div>
                <div class="stat">
                    <div class="stat-label">Calls</div>
                    <div class="stat-value">${totalCalls}</div>
                    <div class="stat-sub">realizadas</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Contenido</div>
                    <div class="stat-value">${totalContenido}</div>
                    <div class="stat-sub">piezas publicadas</div>
                </div>
            </div>
            
            <div class="grid">
                <div>
                    <div class="card">
                        <div class="card-title">Progreso al Objetivo<span>${progreso}%</span></div>
                        <div class="progress-row">
                            <div class="progress-header"><span>${formatMoney(totalIngresos)}</span><span>${formatMoney(objetivo)}</span></div>
                            <div class="progress-bar"><div class="progress-fill" style="width:${Math.min(progreso,100)}%"></div></div>
                        </div>
                        <div style="margin-top:20px;padding-top:16px;border-top:1px solid #1a1a1a;font-size:14px;">
                            ${progreso >= 100 ? '<span style="color:#fff;">Objetivo alcanzado</span>' : 'Faltan <strong style="color:#fff;">' + formatMoney(Math.max(0, objetivo - totalIngresos)) + '</strong> para tu objetivo'}
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Ultima Llamada</div>
                        ${calls.length > 0 ? (function(){
                            var last = calls[calls.length-1];
                            var d = new Date(last.fecha);
                            var problemsList = (last.problemas || '').split('\\n').filter(function(p){return p.trim();});
                            return '<div><div style="color:#666;font-size:12px;margin-bottom:12px;">'+d.getDate()+'/'+(d.getMonth()+1)+'/'+d.getFullYear()+' - '+(last.duracion||30)+' min</div>'+(last.sugerencias ? '<div style="font-size:13px;color:#888;line-height:1.5;padding:12px;background:#111;border-left:2px solid #fff;border-radius:0 4px 4px 0;">'+last.sugerencias.replace(/\\n/g,'<br>')+'</div>' : '<div style="color:#666;font-size:13px;">Sin sugerencias registradas</div>')+'</div>';
                        })() : '<div class="empty" style="padding:20px;">No hay llamadas registradas<br><br><a href="'+CALENDLY_URL+'" target="_blank" class="btn btn-sm">Reservar primera llamada</a></div>'}
                    </div>
                </div>
                
                <div>
                    <div class="card">
                        <div class="card-title">Links Rapidos</div>
                        ${linkHtml('Google Drive', clientLinks.drive ? 'Documentos' : '', clientLinks.drive)}
                        ${linkHtml('Miro', clientLinks.miro ? 'Tableros' : '', clientLinks.miro)}
                        ${linkHtml('Otros', clientLinks.otros ? 'Recursos' : '', clientLinks.otros)}
                        <a href="${CALENDLY_URL}" target="_blank" class="link-item" style="margin-top:16px;border-color:#333;">
                            <div class="link-icon">+</div>
                            <div>
                                <div class="link-title">Reservar llamada 1-1</div>
                                <div class="link-desc">Agenda tu proxima sesion</div>
                            </div>
                        </a>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">Problemas<span>${openProblems} abiertos</span></div>
                        ${openProblems > 0 ? problems.filter(function(p){return p.status==='open';}).slice(0,2).map(function(p){return '<div style="padding:10px 0;border-bottom:1px solid #1a1a1a;font-size:13px;">'+p.titulo+'</div>';}).join('') : '<div style="color:#666;font-size:13px;padding:8px 0;">Todo en orden</div>'}
                        <button class="btn btn-sm" style="margin-top:12px;width:100%;" onclick="showPage('problemas')">Ver todos</button>
                    </div>
                </div>
            </div>
            
            <div class="footer">GH Consulting 2026</div>
        </div>
        
        <!-- HISTORIAL -->
        <div class="page" id="page-metricas">
            <div class="page-header"><div><h1>Historial de Metricas</h1><p>Todos tus reportes semanales</p></div></div>
            <div class="card">${historyHtml}</div>
            ${weeklyReports.length > 0 ? '<div class="card"><div class="card-title">Resumen del Programa</div><div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;text-align:center;"><div><div style="font-size:24px;font-weight:300;">' + weeklyReports.length + '</div><div style="font-size:10px;color:#666;margin-top:4px;">SEMANAS</div></div><div><div style="font-size:24px;font-weight:300;color:#fff;">' + formatMoney(totalIngresos - ingresos) + '</div><div style="font-size:10px;color:#666;margin-top:4px;">GENERADO</div></div><div><div style="font-size:24px;font-weight:300;">' + (totalCalls > 0 ? Math.round((totalClientes - parseInt(data.clientes||0))/totalCalls*100) : 0) + '%</div><div style="font-size:10px;color:#666;margin-top:4px;">CIERRE</div></div><div><div style="font-size:24px;font-weight:300;">' + (weeklyReports.length > 0 ? Math.round(totalContenido/weeklyReports.length) : 0) + '</div><div style="font-size:10px;color:#666;margin-top:4px;">CONTENT/SEM</div></div></div></div>' : ''}
        </div>
        
        <!-- REPORTE -->
        <div class="page" id="page-reporte">
            <div class="page-header"><div><h1>Reporte Semanal</h1><p>Actualiza tus metricas cada semana</p></div></div>
            <div class="card">
                <div class="card-title">Enviar Nuevo Reporte</div>
                <p style="color:#888;font-size:13px;margin-bottom:20px;">Completa este formulario cada semana para trackear tu progreso y que podamos ajustar la estrategia juntos.</p>
                <button class="btn btn-primary" onclick="openModal('reportModal')">Completar Reporte</button>
            </div>
        </div>
        
        <!-- PROBLEMAS -->
        <div class="page" id="page-problemas">
            <div class="page-header">
                <div><h1>Problemas</h1><p>Bloqueos y obstaculos</p></div>
                <button class="btn btn-primary" onclick="openModal('problemModal')">+ Nuevo</button>
            </div>
            <div class="card">${problemsHtml}</div>
        </div>
        
        <!-- LLAMADAS -->
        <div class="page" id="page-llamadas">
            <div class="page-header">
                <div><h1>Registro de Llamadas</h1><p>Historial de sesiones 1-1</p></div>
                <div class="header-actions">
                    <a href="${CALENDLY_URL}" target="_blank" class="btn">Reservar llamada</a>
                    <button class="btn btn-primary" onclick="openModal('callModal')">+ Registrar</button>
                </div>
            </div>
            ${callsHtml}
        </div>
        
        <!-- LINKS -->
        <div class="page" id="page-links">
            <div class="page-header"><div><h1>Mis Links</h1><p>Accesos rapidos a tus recursos</p></div></div>
            <div class="card">
                ${linkHtml('Google Drive', clientLinks.drive || 'No configurado', clientLinks.drive)}
                ${linkHtml('Miro', clientLinks.miro || 'No configurado', clientLinks.miro)}
                ${linkHtml('Otros', clientLinks.otros || 'No configurado', clientLinks.otros)}
            </div>
            <div class="card" style="margin-top:20px;">
                <div class="card-title">Reservar Llamada</div>
                <a href="${CALENDLY_URL}" target="_blank" class="btn btn-primary" style="width:100%;justify-content:center;">Agendar llamada 1-1 con Guillermo</a>
            </div>
            <p style="color:#555;font-size:12px;margin-top:16px;text-align:center;">Para configurar tus links, ve a Configurar</p>
        </div>
        
        <!-- CONFIG -->
        <div class="page" id="page-config">
            <div class="page-header"><div><h1>Configuracion</h1><p>Personaliza tu dashboard</p></div></div>
            <div class="card">
                <div class="card-title">Links Personales</div>
                <p style="color:#888;font-size:13px;margin-bottom:20px;">Anade los links a tus recursos para tenerlos siempre a mano.</p>
                <div class="config-item">
                    <span class="config-label">Drive</span>
                    <input type="url" class="form-input" id="cfg_drive" placeholder="https://drive.google.com/..." value="${clientLinks.drive||''}">
                </div>
                <div class="config-item">
                    <span class="config-label">Miro</span>
                    <input type="url" class="form-input" id="cfg_miro" placeholder="https://miro.com/..." value="${clientLinks.miro||''}">
                </div>
                <div class="config-item">
                    <span class="config-label">Otros</span>
                    <input type="url" class="form-input" id="cfg_otros" placeholder="https://..." value="${clientLinks.otros||''}">
                </div>
                <button class="btn btn-primary" style="margin-top:20px;width:100%;" onclick="saveConfig()">Guardar Configuracion</button>
            </div>
        </div>
    `;
}

function formatMoney(n) {
    return 'EUR ' + parseInt(n||0).toLocaleString();
}

function showPage(page) {
    document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
    document.querySelectorAll('.nav-item').forEach(function(n){ n.classList.remove('active'); });
    var el = document.getElementById('page-' + page);
    if(el) el.classList.add('active');
    var navMap = {dashboard:0, metricas:1, reporte:2, problemas:3, llamadas:4, links:5, config:6};
    var navItems = document.querySelectorAll('.nav-item');
    if(navItems[navMap[page]]) navItems[navMap[page]].classList.add('active');
}

function openModal(id) { 
    document.getElementById(id).classList.add('active'); 
    if (id === 'callModal') {
        document.getElementById('call_fecha').value = new Date().toISOString().split('T')[0];
    }
}
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

document.getElementById('weeklyForm').onsubmit = function(e) {
    e.preventDefault();
    weeklyReports.push({
        date: new Date().toISOString(),
        ingresos: document.getElementById('rpt_ingresos').value || 0,
        clientes: document.getElementById('rpt_clientes').value || 0,
        calls: document.getElementById('rpt_calls').value || 0,
        leads: document.getElementById('rpt_leads').value || 0,
        contenido: document.getElementById('rpt_contenido').value || 0,
        seguidores: document.getElementById('rpt_seguidores').value || 0,
        notas: document.getElementById('rpt_notas').value
    });
    localStorage.setItem('gh_weekly_reports', JSON.stringify(weeklyReports));
    closeModal('reportModal');
    location.reload();
};

document.getElementById('problemForm').onsubmit = function(e) {
    e.preventDefault();
    if (!document.getElementById('prob_titulo').value.trim()) return;
    problems.push({
        date: new Date().toISOString(),
        titulo: document.getElementById('prob_titulo').value,
        desc: document.getElementById('prob_desc').value,
        status: 'open'
    });
    localStorage.setItem('gh_problems', JSON.stringify(problems));
    closeModal('problemModal');
    location.reload();
};

document.getElementById('callForm').onsubmit = function(e) {
    e.preventDefault();
    calls.push({
        fecha: document.getElementById('call_fecha').value || new Date().toISOString().split('T')[0],
        duracion: document.getElementById('call_duracion').value || 30,
        transcript: document.getElementById('call_transcript').value,
        problemas: document.getElementById('call_problemas').value,
        sugerencias: document.getElementById('call_sugerencias').value
    });
    localStorage.setItem('gh_calls', JSON.stringify(calls));
    closeModal('callModal');
    location.reload();
};

window.toggleProblem = function(i) {
    problems[i].status = problems[i].status === 'open' ? 'resolved' : 'open';
    localStorage.setItem('gh_problems', JSON.stringify(problems));
    location.reload();
};

window.deleteCall = function(i) {
    if (confirm('Eliminar esta llamada?')) {
        calls.splice(i, 1);
        localStorage.setItem('gh_calls', JSON.stringify(calls));
        location.reload();
    }
};

window.saveConfig = function() {
    clientLinks = {
        drive: document.getElementById('cfg_drive').value,
        miro: document.getElementById('cfg_miro').value,
        otros: document.getElementById('cfg_otros').value,
        calendly: clientLinks.calendly
    };
    localStorage.setItem('gh_client_links', JSON.stringify(clientLinks));
    alert('Configuracion guardada');
    location.reload();
};

document.querySelectorAll('.modal').forEach(function(m) {
    m.onclick = function(e) { if(e.target === this) closeModal(this.id); };
});
</script>
</body>
</html>
